(()=>{"use strict";const e=/^((bubble::)?[a-zA-Z0-9\-_ ]+::[a-zA-Z0-9\-_ ]+)(,([a-zA-Z0-9\-_ ]+::[a-zA-Z0-9\-_ ]+))*$/,t=new WeakMap,n=new WeakMap,r=new WeakMap,o=new Map,i={getPrototypeOf:function(e){return Object.getPrototypeOf(e)},get:function(e,n){const{element:r,exported:o,func_bind:i,func_relink:s,func_bind_event:l,func_unbind_event:c,func_emit_event:u}=t.get(e);return"element"===n?r:"is_accessor"===n||("bind"===n?i:"relink"===n?s:"on"===n||"addEventListener"===n?l:"off"===n||"removeEventListener"===n?c:"emit"===n||"dispatchEvent"===n?u:o[n]||e[n])},set:function(e,n,r){if("element"===n)return!1;if("bind"===n)return!1;if("relink"===n)return!1;const{exported:o}=t.get(e);return o[n]||(e[n]=r),!0}},s=e=>{const n=new l(e),o=new Proxy(n,i);return Object.assign(t.get(n),{proxy:o,func_bind:l.prototype.bind.bind(n),func_relink:l.prototype.relink.bind(n),func_bind_event:m.bind(n,o),func_unbind_event:d.bind(n,o),func_emit_event:p.bind(n,o)}),r.set(e,o),o};s.Version="1.0.11",s.DOM=(e,t="script")=>{if(!("<"===e[0]&&">"===e[e.length-1]))return"~* "===e.substring(0,3)?document.querySelectorAll(e.substring(3)):document.querySelector(e);if("<script>"===e)return document.createElement("script");const n=document.implementation.createHTMLDocument(document.title||"");n.body.innerHTML=e;const r=t.split(",");for(const e of r){const t=n.body.querySelectorAll(e);for(const e of t)e.remove()}const o=Array.prototype.slice.call(n.body.children,0);return o.length<2?o[0]||null:o},s.BindInst=(e,t,n=!0)=>{if("function"!=typeof t)throw new TypeError("Argument 2 must be a constructor!");e=(""+(e||"")).trim();const r=Object.create(null);r.controller=t,r.construct=!!n,o.set(e,r)},s.controller=(e,t,n=!0)=>(console.warn("WhelmJS.controller is marked as deprecated! Please use WhelmJS.BindInst instead!"),s.BindInst(...Array.prototype.slice.call(arguments,0))),s.DefineBlueprint=(e,t,n=!0)=>(console.warn("WhelmJS.DefineBlueprint is marked as deprecated! Please use WhelmJS.BindInst instead!"),s.BindInst(...Array.prototype.slice.call(arguments,0))),s.GetInstance=e=>r.get(e)||null,window.WhelmJS=Object.freeze(s);class l{constructor(e=null){const n=Object.assign(Object.create(null),{element:null,exported:Object.create(null)});t.set(this,n),0!==arguments.length&&this.bind(e)}bind(e){if(!(e instanceof Element))throw new TypeError("ElmAccessor constructor only accept Element instances!");const n=t.get(this);n.element=e,n.exported=Object.create(null),this.relink()}relink(){const e=t.get(this);e.exported=Object.create(null);const{element:n,exported:r}=e;!function e(t,n,r){const o=[];for(const e of Array.prototype.slice.call(r.children,0)){const r=u(t,n,e);null===r&&(e instanceof HTMLTemplateElement?o.push(e.content):o.push(e)),a(n,e,r)}for(const r of o)e(t,n,r)}(r,n,n)}}class c{constructor(e){if("string"==typeof e){var t=document.implementation.createHTMLDocument();if(t.body.innerHTML=e,1!==t.body.children.length)throw new TypeError("HTMLTemplate constructor only html string that is resolved as single Element instance!");e=t.body.children[0]}else{if(!(e instanceof Element))throw new TypeError("HTMLTemplate constructor only accepts an Element instance!");e.remove(),e=e.cloneNode(!0)}Object.defineProperties(this,{_tmpl_elm:{configurable:!1,writable:!1,enumerable:!1,value:e}}),e.removeAttribute("elm-export-tmpl"),e.removeAttribute("elm-export")}get is_template(){return!0}duplicate(){return s(this._tmpl_elm.cloneNode(!0))}}function u(e,t,n){if(!n.hasAttribute("elm-export"))return!1;n.hasAttribute("elm-detached")&&n.remove();const i=n.getAttribute("elm-export");let l=null;if(n.hasAttribute("elm-export-inst")){const e=n.getAttribute("elm-export-inst").trim();if(e&&"accessor"!==e)if("template"===e)l=new c(n);else{const t=o.get(e);if(!t)throw new TypeError(`Destination controller '${e}' is not registered yet!`);const{controller:r,construct:i}=t;l=i?new r(n):r(n)}else l=s(n)}else n.hasAttribute("elm-export-tmpl")?l=new c(n):n.hasAttribute("elm-export-accessor")&&(l=s(n));return e[i]=l||n,l?(r.set(n,e[i]=l),l):(e[i]=n,null)}function a(t,r,o){const i=r.hasAttribute("elm-bind-event"),s=r.hasAttribute("elm-bind-event-bubble");if(i||s){let i=n.get(r);i||(i=new Map,n.set(r,i));const l=r.getAttribute(s?"elm-bind-event-bubble":"elm-bind-event").trim();if(!e.test(l))throw new SyntaxError(`Incorrect event '${l}' in 'elm-bind-event' tag`);const c=l.split(",");for(const e of c){const n=e.split("::");let l,c,u=null;2===n.length?[l,c]=n:[u,l,c]=n;const a=s||!!u;let m=l.trim(),d=c.trim();""===d&&(d=m);const p=`${m}::${d}`,b=i.get(p);b&&(r.removeEventListener(m,b),i.delete(p));const f=e=>{const n=new Event(d,{bubbles:a});Object.defineProperties(n,{original:{value:e,configurable:!1,enumerable:!0,writable:!1},instance:o,original_event:{get:()=>(console.error("original_event property is deprecated and will be removed soon! Please use original instead!"),n.original),configurable:!1,enumerable:!0}}),t.dispatchEvent(n)};r.addEventListener(m,f),i.set(p,f)}}}function m(e,n,r,...o){const{element:i}=t.get(this);if(!i)return e;const s=n.split(",");for(const e of s)i.addEventListener(e,r,...o);return e}function d(e,n,r,...o){const{element:i}=t.get(this);if(!i)return e;const s=n.split(",");for(const e of s)i.removeEventListener(e,r,...o);return e}function p(e,n){const{element:r}=t.get(this);if(!r)return e;if("string"==typeof n&&(n=new Event(n)),!(n instanceof Event))throw new TypeError("Argument 1 must be a string or an Event instance!");return r.dispatchEvent(n),e}})();

(()=>{"use strict";const e=new WeakMap,t=new WeakMap,n=new WeakMap,r=new Map,o=Object.create(null),i=Object.create(null),c={Version:"1.2.2"};{const h=/^((bubble::)?[a-zA-Z0-9\-_ ]+::[a-zA-Z0-9\-_ ]+)(,(bubble::)?([a-zA-Z0-9\-_ ]+::[a-zA-Z0-9\-_ ]+))*$/,g=/^([a-zA-Z0-9\-_#.]+(::[a-zA-Z0-9\-_]+)?)(,([a-zA-Z0-9\-_#.]+(::[a-zA-Z0-9\-_]+)?))*$/;o.IWhelmJS=function(e,t=null){if(!(e instanceof Element))throw new TypeError("Given item must be an Element instance!");let r,o,i;return[o,i]=arguments.length>1?a(t):p(e),r=""===o||"accessor"===o?s(e):"template"===o?new v(e,i):m(o,e),n.set(e,r),r},c.DOM=function(e,t="script"){if(!("<"===e[0]&&">"===e[e.length-1]))return"~* "===e.substring(0,3)?document.querySelectorAll(e.substring(3)):document.querySelector(e);if("<script>"===e)return document.createElement("script");const n=document.implementation.createHTMLDocument(document.title||"");n.body.innerHTML=e;const r=t.split(",");for(const e of r){const t=n.body.querySelectorAll(e);for(const e of t)e.remove()}const o=Array.prototype.slice.call(n.body.children,0);return o.length<2?o[0]||null:o},c.BindInst=function(e,t,n=!0){if("function"!=typeof t)throw new TypeError("Argument 2 must be a constructor!");e=(""+(e||"")).trim();const o=Object.create(null);o.controller=t,o.construct=!!n,r.set(e,o)},c.GetInst=c.GetInstance=function(e){return n.get(e)||null},c.Extend=function(e){if(Object(e)!==e)throw new TypeError("Given extension must be a object!");Object.assign(i,e)};const w={getPrototypeOf:function(e){return Object.getPrototypeOf(e)},get:function(t,n){const{element:r,exported:o,func_bind:i,func_relink:c,func_bind_event:s,func_unbind_event:l,func_emit_event:u}=e.get(t);return"element"===n?r:"is_accessor"===n||("bind"===n?i:"relink"===n?c:"on"===n||"addEventListener"===n?s:"off"===n||"removeEventListener"===n?l:"emit"===n||"dispatchEvent"===n?u:o[n]||t[n])},set:function(t,n,r){if("element"===n)return!1;if("bind"===n)return!1;if("relink"===n)return!1;const{exported:o}=e.get(t);return o[n]||(t[n]=r),!0}};function s(t){const r=new y(t),o=new Proxy(r,w);return Object.assign(e.get(r),{proxy:o,func_bind:y.prototype.bind.bind(r),func_relink:y.prototype.relink.bind(r),func_bind_event:f.bind(r,o),func_unbind_event:b.bind(r,o),func_emit_event:d.bind(r,o)}),n.set(t,o),o}class y{constructor(t=null){const n=Object.assign(Object.create(null),{element:null,exported:Object.create(null)});e.set(this,n),0!==arguments.length&&this.bind(t)}bind(t){if(!(t instanceof Element))throw new TypeError("ElmAccessor constructor only accept Element instances!");const n=e.get(this);n.element=t,n.exported=Object.create(null),this.relink()}relink(){const t=e.get(this);t.exported=Object.create(null);const{element:n,exported:r}=t;!function e(t,n,r){const o=[];for(const e of Array.prototype.slice.call(r.children,0)){const r=l(t,n,e);null===r&&(e instanceof HTMLTemplateElement?o.push(e.content):o.push(e)),u(n,e,r)}for(const r of o)e(t,n,r)}(r,n,n)}}class v{constructor(e,t=""){if("string"==typeof e){var n=document.implementation.createHTMLDocument();if(n.body.innerHTML=e,1!==n.body.children.length)throw new TypeError("HTMLTemplate constructor only html string that is resolved as single Element instance!");e=n.body.children[0]}else{if(!(e instanceof Element))throw new TypeError("HTMLTemplate constructor only accepts an Element instance!");e.remove(),e=e.cloneNode(!0)}Object.defineProperties(this,{_tmpl_elm:{configurable:!1,writable:!1,enumerable:!1,value:e},_tmpl_dst_inst:{configurable:!1,writable:!1,enumerable:!1,value:t||"accessor"}}),e.removeAttribute("elm-export-tmpl"),e.removeAttribute("elm-export-inst"),e.removeAttribute("elm-export")}get is_template(){return!0}duplicate(){const{_tmpl_elm:e,_tmpl_dst_inst:t}=this,r=e.cloneNode(!0),o="accessor"===t?s(r):m(t,r);return n.set(r,o),o}}function l(e,t,r){const o=r.hasAttribute("elm-export"),i=r.hasAttribute("elm-export-inst"),c=r.hasAttribute("elm-export-accessor"),l=r.hasAttribute("elm-export-tmpl");if(!(o||i||c||l))return null;const u=!!o&&(r.getAttribute("elm-export")||"").trim();if(""===u)throw console.error(r),new SyntaxError("[elm-export] attribute's content value should not be empty!");o&&r.hasAttribute("elm-detached")&&r.remove();const[a,f]=p(r);if(""===a)return!1!==u&&(e[u]=r),null;let b;return b="accessor"===a?s(r):"template"===a?new v(r,f):m(a,r),n.set(r,b),!1!==u&&(e[u]=b),b}function u(e,n,r){const i=n.hasAttribute("elm-bind-event"),c=n.hasAttribute("elm-bind-event-bubble");if(i||c){let o=t.get(n);o||(o=new Map,t.set(n,o));const i=n.getAttribute(c?"elm-bind-event-bubble":"elm-bind-event").trim();if(!h.test(i))throw console.error(n),new SyntaxError(`Incorrect event '${i}' in ${n.tagName}[elm-bind-event] attribute!`);const s=i.split(",");for(const t of s){const i=t.split("::");let s,l,u=null;2===i.length?[s,l]=i:[u,s,l]=i;const a=c||!!u;let p=s.trim(),m=l.trim();""===m&&(m=p);const f=`${p}::${m}`,b=o.get(f);b&&(n.removeEventListener(p,b),o.delete(f));const d=t=>{const o=new Event(m,{bubbles:a});Object.defineProperties(o,{original:{value:t,configurable:!1,enumerable:!0,writable:!1},instance:{value:r||n,configurable:!1,enumerable:!0,writable:!1},original_event:{get:()=>(console.error("original_event property is deprecated and will be removed soon! Please use original instead!"),o.original),configurable:!1,enumerable:!0}}),e.dispatchEvent(o)};n.addEventListener(p,d),o.set(f,d)}}if(n.hasAttribute("elm-map-text")){const e=n.getAttribute("elm-map-text");if(!g.test(e))throw console.error(n),new SyntaxError(`Given ${n.tagName}[elm-map-text] attribute contains invalid attribute!`);const t=e.trim().split(",").map(e=>e.trim()).filter(e=>""!==e);for(const e of t){const[t,r]=e.split("::").map(e=>e.trim()),i=o.MAP_TEXT(t);r?n.setAttribute(r,i):n.textContent=i}}}function a(e){const[t,n]=(""+e||"").trim().split("::");if(void 0!==n&&"template"!==t)throw new SyntaxError("Invalid instance descriptor!");if(!t||"accessor"===t)return["accessor"];if("template"===t){const e=["template"];return n&&e.push(n),e}return[t]}function p(e){if(e.hasAttribute("elm-export-inst"))try{return a(e.getAttribute("elm-export-inst"))}catch(t){throw console.error(e),t}else{if(e.hasAttribute("elm-export-tmpl"))return["template"];if(e.hasAttribute("elm-export-accessor"))return["accessor"]}return[""]}function m(e,t){const n=r.get(e);if(!n)throw console.error(t),new TypeError(`Destination controller '${e}' is not registered yet!`);const{controller:o,construct:i}=n;return i?new o(t):o(t)}function f(t,n,r,...o){const{element:i}=e.get(this);if(!i)return t;const c=n.split(",").map(e=>e.trim());for(const e of c)i.addEventListener(e,r,...o);return t}function b(t,n,r,...o){const{element:i}=e.get(this);if(!i)return t;const c=n.split(",").map(e=>e.trim());for(const e of c)i.removeEventListener(e,r,...o);return t}function d(t,n){const{element:r}=e.get(this);if(!r)return t;if("string"==typeof n&&(n=new Event(n)),!(n instanceof Event))throw new TypeError("Argument 1 must be a string or an Event instance!");return r.dispatchEvent(n),t}}{const e=Object.create(null);e._default=[];let t="";c.UseTextMapGroup=function(e){t=(""+(e||"")).trim()},c.BindTextMap=function(t,n="_default"){if("string"!=typeof n)throw new TypeError("Input map group should be a string identifier!");const r="function"==typeof t,o=Object(t)===t;if(!r&&!o)throw new TypeError("Input map should be an object or a function!");const i=e[n]=e[n]||[];i.indexOf(t)<0&&i.push(t)},c.UnbindTextMap=function(t,n="_default"){if("string"!=typeof n)throw new TypeError("Input map group should be a string identifier!");const r="function"==typeof t,o=Object(t)===t;if(!r&&!o)throw new TypeError("Input map should be an object or a function!");const i=e[n]=e[n]||[],c=i.indexOf(t);c>=0&&i.splice(c,1)},o.MAP_TEXT=function(n){const r=e[t]||e._default;for(let e=r.length;e>0;e--){const t=r[e-1],o="function"==typeof t?t(n):t[n];if(void 0!==o)return""+(o||"")}return n}}window.WhelmJS=new Proxy(o.IWhelmJS,{apply:function(e,t,n){return o.IWhelmJS.apply(t,n)},get:function(e,t){return c[t]||i[t]},set:function(){throw new Error("Setting property directly is not allowed! Please use WhelmJS.Extend instead!")}})})();

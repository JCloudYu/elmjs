(()=>{"use strict";const e=/^((bubble::)?[a-zA-Z0-9\-_ ]+::[a-zA-Z0-9\-_ ]+)(,([a-zA-Z0-9\-_ ]+::[a-zA-Z0-9\-_ ]+))*$/,t=/^([a-zA-Z0-9\-_#.]+(::[a-zA-Z0-9\-_]+)?)(,([a-zA-Z0-9\-_#.]+(::[a-zA-Z0-9\-_]+)?))*$/,n=new WeakMap,r=new WeakMap,o=new WeakMap,i=new Map,s={getPrototypeOf:function(e){return Object.getPrototypeOf(e)},get:function(e,t){const{element:r,exported:o,func_bind:i,func_relink:s,func_bind_event:l,func_unbind_event:c,func_emit_event:a}=n.get(e);return"element"===t?r:"is_accessor"===t||("bind"===t?i:"relink"===t?s:"on"===t||"addEventListener"===t?l:"off"===t||"removeEventListener"===t?c:"emit"===t||"dispatchEvent"===t?a:o[t]||e[t])},set:function(e,t,r){if("element"===t)return!1;if("bind"===t)return!1;if("relink"===t)return!1;const{exported:o}=n.get(e);return o[t]||(e[t]=r),!0}},l=e=>{if(!(e instanceof Element))throw new TypeError("Given item must be an Element instance!");let t;const[n,r]=h(e);return t=""===n||"accessor"===n?p(e):"template"===n?new f(e,r):g(n,e),o.set(e,t),t};l.Version="1.2.0",l.DOM=(e,t="script")=>{if(!("<"===e[0]&&">"===e[e.length-1]))return"~* "===e.substring(0,3)?document.querySelectorAll(e.substring(3)):document.querySelector(e);if("<script>"===e)return document.createElement("script");const n=document.implementation.createHTMLDocument(document.title||"");n.body.innerHTML=e;const r=t.split(",");for(const e of r){const t=n.body.querySelectorAll(e);for(const e of t)e.remove()}const o=Array.prototype.slice.call(n.body.children,0);return o.length<2?o[0]||null:o},l.BindInst=(e,t,n=!0)=>{if("function"!=typeof t)throw new TypeError("Argument 2 must be a constructor!");e=(""+(e||"")).trim();const r=Object.create(null);r.controller=t,r.construct=!!n,i.set(e,r)},l.GetInst=l.GetInstance=e=>o.get(e)||null;const c=Object.create(null);c._default=[];let a="";function u(e){const t=c[a]||c._default;for(let n=t.length;n>0;n--){const r=t[n-1],o="function"==typeof r?r(e):r[e];if(void 0!==o)return""+(o||"")}return e}function p(e){const t=new m(e),r=new Proxy(t,s);return Object.assign(n.get(t),{proxy:r,func_bind:m.prototype.bind.bind(t),func_relink:m.prototype.relink.bind(t),func_bind_event:y.bind(t,r),func_unbind_event:w.bind(t,r),func_emit_event:v.bind(t,r)}),o.set(e,r),r}l.UseTextMapGroup=e=>{a=(""+(e||"")).trim()},l.BindTextMap=function(e,t="_default"){if("string"!=typeof t)throw new TypeError("Input map group should be a string identifier!");const n="function"==typeof e,r=Object(e)===e;if(!n&&!r)throw new TypeError("Input map should be an object or a function!");const o=c[t]=c[t]||[];return o.indexOf(e)<0&&o.push(e),l},l.UnbindTextMap=function(e,t="_default"){if("string"!=typeof t)throw new TypeError("Input map group should be a string identifier!");const n="function"==typeof e,r=Object(e)===e;if(!n&&!r)throw new TypeError("Input map should be an object or a function!");const o=c[t]=c[t]||[],i=o.indexOf(e);return i>=0&&o.splice(i,1),l},l.controller=function(e,t,n=!0){return console.warn("WhelmJS.controller is marked as deprecated! Please use WhelmJS.BindInst instead!"),l.BindInst(...Array.prototype.slice.call(arguments,0))},l.DefineBlueprint=function(e,t,n=!0){return console.warn("WhelmJS.DefineBlueprint is marked as deprecated! Please use WhelmJS.BindInst instead!"),l.BindInst(...Array.prototype.slice.call(arguments,0))},window.WhelmJS=Object.freeze(l);class m{constructor(e=null){const t=Object.assign(Object.create(null),{element:null,exported:Object.create(null)});n.set(this,t),0!==arguments.length&&this.bind(e)}bind(e){if(!(e instanceof Element))throw new TypeError("ElmAccessor constructor only accept Element instances!");const t=n.get(this);t.element=e,t.exported=Object.create(null),this.relink()}relink(){const e=n.get(this);e.exported=Object.create(null);const{element:t,exported:r}=e;!function e(t,n,r){const o=[];for(const e of Array.prototype.slice.call(r.children,0)){const r=b(t,n,e);null===r&&(e instanceof HTMLTemplateElement?o.push(e.content):o.push(e)),d(n,e,r)}for(const r of o)e(t,n,r)}(r,t,t)}}class f{constructor(e,t=""){if("string"==typeof e){var n=document.implementation.createHTMLDocument();if(n.body.innerHTML=e,1!==n.body.children.length)throw new TypeError("HTMLTemplate constructor only html string that is resolved as single Element instance!");e=n.body.children[0]}else{if(!(e instanceof Element))throw new TypeError("HTMLTemplate constructor only accepts an Element instance!");e.remove(),e=e.cloneNode(!0)}Object.defineProperties(this,{_tmpl_elm:{configurable:!1,writable:!1,enumerable:!1,value:e},_tmpl_dst_inst:{configurable:!1,writable:!1,enumerable:!1,value:t||"accessor"}}),e.removeAttribute("elm-export-tmpl"),e.removeAttribute("elm-export-inst"),e.removeAttribute("elm-export")}get is_template(){return!0}duplicate(){const{_tmpl_elm:e,_tmpl_dst_inst:t}=this,n=e.cloneNode(!0),r="accessor"===t?p(n):g(t,n);return o.set(n,r),r}}function b(e,t,n){const r=n.hasAttribute("elm-export"),i=n.hasAttribute("elm-export-inst"),s=n.hasAttribute("elm-export-accessor"),l=n.hasAttribute("elm-export-tmpl");if(!(r||i||s||l))return null;const c=!!r&&(n.getAttribute("elm-export")??"").trim();if(""===c)throw console.error(n),new SyntaxError("[elm-export] attribute's content value should not be empty!");r&&n.hasAttribute("elm-detached")&&n.remove();const[a,u]=h(n);if(""===a)return!1!==c&&(e[c]=n),null;let m;return m="accessor"===a?p(n):"template"===a?new f(n,u):g(a,n),o.set(n,m),!1!==c&&(e[c]=m),m}function d(n,o,i){const s=o.hasAttribute("elm-bind-event"),l=o.hasAttribute("elm-bind-event-bubble");if(s||l){let t=r.get(o);t||(t=new Map,r.set(o,t));const s=o.getAttribute(l?"elm-bind-event-bubble":"elm-bind-event").trim();if(!e.test(s))throw console.error(o),new SyntaxError(`Incorrect event '${s}' in ${o.tagName}[elm-bind-event] attribute!`);const c=s.split(",");for(const e of c){const r=e.split("::");let s,c,a=null;2===r.length?[s,c]=r:[a,s,c]=r;const u=l||!!a;let p=s.trim(),m=c.trim();""===m&&(m=p);const f=`${p}::${m}`,b=t.get(f);b&&(o.removeEventListener(p,b),t.delete(f));const d=e=>{const t=new Event(m,{bubbles:u});Object.defineProperties(t,{original:{value:e,configurable:!1,enumerable:!0,writable:!1},instance:{value:i||o,configurable:!1,enumerable:!0,writable:!1},original_event:{get:()=>(console.error("original_event property is deprecated and will be removed soon! Please use original instead!"),t.original),configurable:!1,enumerable:!0}}),n.dispatchEvent(t)};o.addEventListener(p,d),t.set(f,d)}}if(o.hasAttribute("elm-map-text")){const e=o.getAttribute("elm-map-text");if(!t.test(e))throw console.error(o),new SyntaxError(`Given ${o.tagName}[elm-map-text] attribute contains invalid attribute!`);const n=e.trim().split(",").map(e=>e.trim()).filter(e=>""!==e);for(const e of n){const[t,n]=e.split("::").map(e=>e.trim()),r=u(t);n?o.setAttribute(n,r):o.textContent=r}}}function h(e){if(e.hasAttribute("elm-export-inst")){const[t,n]=e.getAttribute("elm-export-inst").trim().split("::");if(void 0!==n&&"template"!==t)throw console.error(e),new SyntaxError("Instance resolution operator :: is only allowed in template mode!");return t&&"accessor"!==t?"template"===t?["template",n||null]:[t]:["accessor"]}return e.hasAttribute("elm-export-tmpl")?["template"]:e.hasAttribute("elm-export-accessor")?["accessor"]:[""]}function g(e,t){const n=i.get(e);if(!n)throw console.error(t),new TypeError(`Destination controller '${e}' is not registered yet!`);const{controller:r,construct:o}=n;return o?new r(t):r(t)}function y(e,t,r,...o){const{element:i}=n.get(this);if(!i)return e;const s=t.split(",");for(const e of s)i.addEventListener(e,r,...o);return e}function w(e,t,r,...o){const{element:i}=n.get(this);if(!i)return e;const s=t.split(",");for(const e of s)i.removeEventListener(e,r,...o);return e}function v(e,t){const{element:r}=n.get(this);if(!r)return e;if("string"==typeof t&&(t=new Event(t)),!(t instanceof Event))throw new TypeError("Argument 1 must be a string or an Event instance!");return r.dispatchEvent(t),e}})();
